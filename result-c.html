<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Result Calculator</title>
    <style>
      /* Base styles */
      body {
        text-transform: capitalize;
        font-family: Arial, sans-serif;
        margin: 20px;
        padding: 0;
        box-sizing: border-box;
      }

      table {
        width: 100%;
        border-collapse: collapse;
        overflow-x: auto;
        display: block;
        /* Allows horizontal scrolling */
      }

      th,
      td {
        padding: 8px;
        text-align: center;
        border: 1px solid #ddd;
        white-space: nowrap;
        /* Prevents wrapping */
      }

      input[type="number"],
      input[type="text"] {
        width: 80px;
        padding: 5px;
        text-align: center;
        font-size: 0.9rem;
      }

      button {
        margin: 10px 5px;
        padding: 10px 15px;
        background-color: #4caf50;
        color: rgb(20, 20, 20);
        border: none;
        cursor: pointer;
        /* font-size: 0.9rem; */
        font-size: 16px;
        font-weight: 600;
      }

      button:hover {
        background-color: #5fc464;
        color: #f1f6f1;
      }

      #calculate-btn {
        background-color: #008cba;
      }

      .delete-btn {
        background-color: #f44336;
      }
      .delete-btn:hover {
        background-color: #f9695f;
      }
      #total-marks {
        width: 130px;
        padding: 4.7px;
        height: 25px;
      }
      #download-pdf-btn {
        display: inline-block;
      }
      .delete-btns {
        display: inline-block;
      }
      #warningModal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
        justify-content: center;
        align-items: center;
      }

      #modalContent {
        background-color: #fff;
        padding: 20px;
        width: 300px;
        border: 3px solid #cac009;
        box-shadow: 2px 2px 2px rgb(104, 97, 97);
      }

      .modal-buttons {
        margin-top: 10px;
        display: flex;
        justify-content: space-between;
      }

      .btn {
        padding: 8px 16px;
        background-color: #4caf50;
        color: white;
        border: none;
        cursor: pointer;
        margin-left: 30px;
      }

      .btn:hover {
        background-color: #45a049;
      }

      #dontShowAgain {
        margin-top: 10px;
        display: flex;
        margin-left: 21px;
        justify-content: center;
        align-items: center;
      }

      #dontShowAgain input {
        margin-right: 10px;
      }

      /* Responsive adjustments */
      @media (max-width: 768px) {
        th,
        td {
          padding: 6px;
        }

        input[type="number"],
        input[type="text"] {
          width: 60px;
        }

        button {
          font-size: 0.8rem;
          padding: 8px 12px;
        }

        #total-marks {
          width: 80px;
        }
        #download-pdf-btn {
          display: flex;
          justify-content: center;
          align-items: center;
          gap: 12px;
        }

        #dontShowAgain button {
          width: 60px;
        }
      }

      .tooltiped-btn {
        position: relative;
        padding: 10px 20px;
        font-size: 16px;
        cursor: pointer;
      }

      /* Tooltip container */
      .tooltip {
        visibility: hidden;
        width: 50px;
        /* background-color: rgba(0, 0, 0, 0.7); */
        background-color: #6cea70;
        color: #fff;
        text-align: center;
        border-radius: 5px;
        padding: 10px;
        position: absolute;
        z-index: 1;
        bottom: 125%; /* Position above the button */
        left: 70%;
        margin-left: -75px;
        opacity: 0;
        transition: opacity 0.3s;
      }

      /* Tooltip arrow */
      .tooltip::after {
        content: "";
        position: absolute;
        top: 100%;
        left: 50%;
        margin-left: -5px;
        border-width: 5px;
        border-style: solid;
        border-color: #6cea70 transparent transparent transparent;
      }

      /* Show the tooltip when hovering over the button */
      .tooltiped-btn:hover .tooltip {
        visibility: visible;
        opacity: 1;
      }

      @media (max-width: 480px) {
        h1 {
          font-size: 1.5rem;
          text-align: center;
        }

        table {
          font-size: 0.9rem;
          /* Smaller font for smaller screens */
        }

        button {
          width: 100%;
          padding: 10px 0;
          font-size: 1rem;
          margin: 5px 0;
        }

        input[type="number"],
        input[type="text"] {
          width: 50px;
          font-size: 0.8rem;
        }

        #total-marks {
          width: 96.5%;
          margin: 5px 0 10px 0;
        }
        #download-pdf-btn {
          display: flex;
          justify-content: center;
          align-items: center;
          gap: 12px;
        }
        .delete-btns {
          display: flex;
          gap: 10px;
        }
        .delete-btns :button {
          display: flex;
          gap: 10px;
        }
      }
    </style>
  </head>

  <body>
    <h1 style="text-align: center">Result Compiler</h1>
    <div class="delete-btns">
      <button class="tooltiped-btn" id="add-row-btn">
        Add New Student
        <!-- Tooltip for Add Student Row -->
        <div class="tooltip">
          <img
            width="30"
            height="30"
            src="https://img.icons8.com/ios/50/select-row.png"
            alt="select-row"
          />
        </div>
      </button>

      <button class="tooltiped-btn" id="add-column-btn">
        Add New Subject
        <!-- Tooltip with the image icon -->
        <div class="tooltip">
          <img
            width="30"
            height="30"
            src="https://img.icons8.com/ios/50/select-column.png"
            alt="select-column"
          />
        </div>
      </button>
    </div>

    <!-- <button onclick="deleteData()" id="delete-btn">Delete Data</button> -->
    <div class="delete-btns">
      <button onclick="deleteData()" class="delete-btn">Delete Data</button>
      <button onclick="deleteColumn()" class="delete-btn">Delete Column</button>
    </div>
    <input
      id="total-marks"
      type="number"
      placeholder="Enter Total Marks"
      required
    />

    <table id="result-table">
      <thead>
        <tr></tr>
      </thead>
      <tbody></tbody>
    </table>

    <button id="calculate-btn">Compile</button>
    <button id="download-pdf-btn">
      Download PDF
      <img
        width="15"
        height="15"
        src="https://img.icons8.com/dotty/80/export-pdf.png"
        alt="export-pdf"
      />
    </button>

    <!-- Modal HTML -->
    <div id="warningModal">
      <div id="modalContent">
        <div style="text-align: center">
          <img
            width="48"
            height="48"
            src="https://img.icons8.com/fluency/48/add-reminder.png"
            alt="add-reminder"
          />
        </div>
        <h3 style="text-align: center">Important Reminder</h3>
        <hr />
        <ol>
          <li>
            Do not forget to press "Compile", otherwise you may lose your data.
          </li>
          <br />
          <li>
            Your data is device dependent, meaning changing device will lead to
            data loss.
          </li>
        </ol>

        <div id="dontShowAgain">
          <input type="checkbox" id="dontShowAgainCheckbox" />
          <label for="dontShowAgainCheckbox">Don't show again</label>
          <button class="btn" id="closeModalButton">O.K</button>
        </div>

        <div class="modal-buttons">
          <!-- <button class="btn" id="closeModalButton">O.K</button> -->
        </div>
      </div>
    </div>

    <!-- jsPDF Library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.4.0/jspdf.umd.min.js"></script>
    <!-- autoTable Plugin -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>

    <script>
      // Get elements
      const resultTable = document
        .getElementById("result-table")
        .getElementsByTagName("tbody")[0];
      const addRowButton = document.getElementById("add-row-btn");
      const addColumnButton = document.getElementById("add-column-btn");
      const calculateButton = document.getElementById("calculate-btn");
      let subjects = ["English", "Eng B/R", "Urdu"]; // Default subjects

      // Add row (student)
      addRowButton.addEventListener("click", () => {
        const row = resultTable.insertRow();
        const serialCell = row.insertCell(0);
        const nameCell = row.insertCell(1);
        const fatherNameCell = row.insertCell(2);

        serialCell.innerHTML = resultTable.rows.length; // Serial number

        const nameInput = document.createElement("input");
        nameInput.type = "text";
        nameInput.placeholder = "Name";
        nameCell.appendChild(nameInput);

        const fatherNameInput = document.createElement("input");
        fatherNameInput.type = "text";
        fatherNameInput.placeholder = "Father's Name";
        fatherNameCell.appendChild(fatherNameInput);

        subjects.forEach((subject, index) => {
          const cell = row.insertCell(index + 3);
          const marksInput = document.createElement("input");
          marksInput.type = "number";
          marksInput.placeholder = subject;
          cell.appendChild(marksInput);
        });

        // Add total, percentage, and grade columns
        row.insertCell(subjects.length + 3); // Empty cell for Total Marks
        row.insertCell(subjects.length + 4); // Empty cell for Percentage
        row.insertCell(subjects.length + 5); // Empty cell for Grade

        // Add delete icon to the row
        const deleteCell = row.insertCell(subjects.length + 6);

        // Create an img element for the delete icon (using inline SVG here)
        const deleteIcon = document.createElement("img");
        deleteIcon.src =
          "data:image/svg+xml;charset=UTF-8," +
          encodeURIComponent(`
      <svg xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" width="25" height="25" viewBox="0 0 48 48">
          <linearGradient id="nyvBozV7VK1PdF3LtMmOna_pre7LivdxKxJ_gr1" x1="18.405" x2="33.814" y1="10.91" y2="43.484" gradientUnits="userSpaceOnUse">
              <stop offset="0" stop-color="#32bdef"></stop>
              <stop offset="1" stop-color="#1ea2e4"></stop>
          </linearGradient>
          <path fill="url(#nyvBozV7VK1PdF3LtMmOna_pre7LivdxKxJ_gr1)" d="M39,10l-2.835,31.181C36.072,42.211,35.208,43,34.174,43H13.826	c-1.034,0-1.898-0.789-1.992-1.819L9,10H39z"></path>
          <path fill="#0176d0" d="M32,7c0-1.105-0.895-2-2-2H18c-1.105,0-2,0.895-2,2c0,0,0,0.634,0,1h16C32,7.634,32,7,32,7z"></path>
          <path fill="#007ad9" d="M7,9.886L7,9.886C7,9.363,7.358,8.912,7.868,8.8C10.173,8.293,16.763,7,24,7s13.827,1.293,16.132,1.8	C40.642,8.912,41,9.363,41,9.886v0C41,10.501,40.501,11,39.886,11H8.114C7.499,11,7,10.501,7,9.886z"></path>
      </svg>`); // Encode SVG as data URI

        deleteIcon.alt = "Delete Row";
        deleteIcon.style.cursor = "pointer"; // Ensure the cursor is a pointer when hovering
        // Change cursor to pointer for UX

        // Add onclick event for the delete icon
        deleteIcon.onclick = () => {
          row.remove();
          saveData(); // Save after deletion
        };

        deleteCell.appendChild(deleteIcon);
      });

      // Add column (subject)
      addColumnButton.addEventListener("click", () => {
        const subjectName = prompt("Enter subject name:");
        if (subjectName) {
          // Add the new subject to the subjects array
          const newSubjectIndex = subjects.length; // New subject's index position
          subjects.push(subjectName);

          // Update header row by inserting at the correct index
          const header = resultTable.closest("table").querySelector("thead tr");
          const newHeaderCell = document.createElement("th");
          newHeaderCell.innerText = subjectName;
          header.insertBefore(
            newHeaderCell,
            header.children[newSubjectIndex + 3]
          ); // Insert at the correct index

          // Add a new subject column for each student row at the correct position
          const rows = resultTable.rows;
          Array.from(rows).forEach((row) => {
            const cell = row.insertCell(newSubjectIndex + 3);
            const marksInput = document.createElement("input");
            marksInput.type = "number";
            marksInput.placeholder = subjectName;
            cell.appendChild(marksInput);
          });

          // Save updated subjects to local storage
          saveData();
        }
      });

      // Delete column (subject)
      function deleteColumn() {
        // Display all subjects with their indices for easy selection
        let subjectList = "";
        subjects.forEach((subject, index) => {
          subjectList += `${index}: ${subject}\n`;
        });

        const subjectToDelete = prompt(
          `Subjects with indices:\n${subjectList}\nEnter the index or name of the subject to delete:`
        );

        if (subjectToDelete !== null) {
          // Check if the input is a valid index
          const index = parseInt(subjectToDelete);

          if (!isNaN(index)) {
            // Valid index input
            if (index >= 0 && index < subjects.length) {
              // Remove the subject from the subjects array
              subjects.splice(index, 1);

              // Update the header row
              const header = resultTable
                .closest("table")
                .querySelector("thead tr");
              header.deleteCell(index + 3);

              // Remove subject columns from each row
              const rows = resultTable.rows;
              Array.from(rows).forEach((row) => {
                row.deleteCell(index + 3); // Delete the subject cell
              });

              // Save updated subjects to local storage
              saveData();
            } else {
              alert("Invalid subject index");
            }
          } else {
            // Check if the input is a valid subject name
            const subjectIndex = subjects.indexOf(subjectToDelete.trim());
            if (subjectIndex !== -1) {
              // Remove the subject from the subjects array
              subjects.splice(subjectIndex, 1);

              // Update the header row
              const header = resultTable
                .closest("table")
                .querySelector("thead tr");
              header.deleteCell(subjectIndex + 3);

              // Remove subject columns from each row
              const rows = resultTable.rows;
              Array.from(rows).forEach((row) => {
                row.deleteCell(subjectIndex + 3); // Delete the subject cell
              });

              // Save updated subjects to local storage
              saveData();
            } else {
              alert("Subject not found");
            }
          }
        }
      }

      // Calculate result
      calculateButton.addEventListener("click", () => {
        let totalMarksforresult = document.getElementById("total-marks").value; // Change const to let
        if (totalMarksforresult === "") {
          // If totalMarksforresult is empty, prompt the user
          totalMarksforresult = prompt(
            "Enter Total Number to calculate % and Grade"
          );

          // If the user cancels or enters an invalid value (e.g., non-numeric), handle it
          if (
            totalMarksforresult === null ||
            isNaN(totalMarksforresult) ||
            totalMarksforresult === ""
          ) {
            alert(
              "Invalid input. Please enter a valid number for total marks."
            );
            return; // Stop further execution if invalid input
          }
        }

        // Proceed with the calculation if the totalMarksforresult is valid
        totalMarksforresult = parseFloat(totalMarksforresult); // Convert the input value to a number

        const rows = resultTable.rows;
        Array.from(rows).forEach((row) => {
          const cells = row.cells;
          if (cells.length > 8) {
            // Skip header row
            let totalMarks = 0;
            for (let i = 3; i < subjects.length + 3; i++) {
              const marks = cells[i].getElementsByTagName("input")[0].value;
              if (marks !== "") {
                totalMarks += parseFloat(marks); // Add up the marks
              }
            }

            const percentage = (totalMarks / totalMarksforresult) * 100; // Calculate percentage
            const grade = getGrade(percentage); // Get grade based on percentage

            // Update the table cells with total marks, percentage, and grade
            cells[subjects.length + 3].innerText = totalMarks;
            cells[subjects.length + 4].innerText = percentage.toFixed(2) + "%";
            cells[subjects.length + 5].innerText = grade;
          }
        });

        sortTableByTotalMarks(); // Sort the table after calculation
        saveData(); // Save the data
      });

      // Sort table by total marks
      function sortTableByTotalMarks() {
        const rows = Array.from(resultTable.rows);
        rows.sort((rowA, rowB) => {
          const totalA = parseFloat(rowA.cells[subjects.length + 3].innerText);
          const totalB = parseFloat(rowB.cells[subjects.length + 3].innerText);
          return totalB - totalA; // Sort descending
        });
        rows.forEach((row) => resultTable.appendChild(row)); // Reorder table rows
      }

      // Get grade based on percentage
      function getGrade(percentage) {
        if (percentage >= 90) return "A+";
        if (percentage >= 80) return "A";
        if (percentage >= 70) return "B";
        if (percentage >= 60) return "C";
        if (percentage >= 50) return "D";
        return "F";
      }

      // Render table from stored data
      function renderTable(students) {
        resultTable.innerHTML = ""; // Clear current table content

        students.forEach((student, index) => {
          const row = resultTable.insertRow();
          row.insertCell(0).innerText = index + 1; // Serial

          // Render Name input
          const nameCell = row.insertCell(1);
          const nameInput = document.createElement("input");
          nameInput.type = "text";
          nameInput.placeholder = "Name";
          nameInput.value = student.name;
          nameInput.onchange = saveData; // Use function reference, not immediate invocation
          nameCell.appendChild(nameInput);

          // Render Father's Name input
          const fatherNameCell = row.insertCell(2);
          const fatherNameInput = document.createElement("input");
          fatherNameInput.type = "text";
          fatherNameInput.placeholder = "Father's Name";
          fatherNameInput.value = student.fatherName;
          fatherNameInput.onchange = saveData; // Use function reference, not immediate invocation
          fatherNameCell.appendChild(fatherNameInput);

          // Render marks inputs dynamically
          student.marks.forEach((mark, subjectIndex) => {
            const marksCell = row.insertCell(subjectIndex + 3);
            const marksInput = document.createElement("input");
            marksInput.type = "number";
            marksInput.value = mark;
            marksInput.onchange = saveData; // Use function reference, not immediate invocation
            marksCell.appendChild(marksInput);
          });

          row.insertCell(subjects.length + 3).innerText = student.totalMarks;
          row.insertCell(subjects.length + 4).innerText =
            student.percentage + "%";
          row.insertCell(subjects.length + 5).innerText = student.grade;

          // Add delete icon to the row
          const deleteCell = row.insertCell(subjects.length + 6);

          // Create an image element for the delete icon (SVG icon)
          const deleteIcon = document.createElement("img");
          deleteIcon.src =
            "data:image/svg+xml;charset=UTF-8," +
            encodeURIComponent(`
      <svg xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" width="25" height="25" viewBox="0 0 48 48">
          <linearGradient id="nyvBozV7VK1PdF3LtMmOna_pre7LivdxKxJ_gr1" x1="18.405" x2="33.814" y1="10.91" y2="43.484" gradientUnits="userSpaceOnUse">
              <stop offset="0" stop-color="#32bdef"></stop>
              <stop offset="1" stop-color="#1ea2e4"></stop>
          </linearGradient>
          <path fill="url(#nyvBozV7VK1PdF3LtMmOna_pre7LivdxKxJ_gr1)" d="M39,10l-2.835,31.181C36.072,42.211,35.208,43,34.174,43H13.826	c-1.034,0-1.898-0.789-1.992-1.819L9,10H39z"></path>
          <path fill="#0176d0" d="M32,7c0-1.105-0.895-2-2-2H18c-1.105,0-2,0.895-2,2c0,0,0,0.634,0,1h16C32,7.634,32,7,32,7z"></path>
          <path fill="#007ad9" d="M7,9.886L7,9.886C7,9.363,7.358,8.912,7.868,8.8C10.173,8.293,16.763,7,24,7s13.827,1.293,16.132,1.8	C40.642,8.912,41,9.363,41,9.886v0C41,10.501,40.501,11,39.886,11H8.114C7.499,11,7,10.501,7,9.886z"></path>
      </svg>`); // Encode SVG as data URI

          deleteIcon.alt = "Delete Row";
          deleteIcon.style.cursor = "pointer"; // Ensure the cursor is a pointer when hovering
          // Change cursor to pointer when hovering

          // Onclick handler for delete icon
          deleteIcon.onclick = () => {
            row.remove(); // Remove the row
            saveData(); // Save after deletion
          };

          // Append the delete icon to the delete cell
          deleteCell.appendChild(deleteIcon);
        });
      }

      // Save data to localStorage
      function saveData() {
        const students = Array.from(resultTable.rows)
          .map((row) => {
            const cells = row.cells;
            if (cells.length > 8) {
              // Skip header row
              const name = cells[1].getElementsByTagName("input")[0].value;
              const fatherName =
                cells[2].getElementsByTagName("input")[0].value;
              const marks = [];
              for (let i = 3; i < subjects.length + 3; i++) {
                marks.push(cells[i].getElementsByTagName("input")[0].value);
              }
              const totalMarks = parseFloat(
                cells[subjects.length + 3].innerText
              );
              const percentage = parseFloat(
                cells[subjects.length + 4].innerText
              );
              const grade = cells[subjects.length + 5].innerText;
              return { name, fatherName, marks, totalMarks, percentage, grade };
            }
          })
          .filter(Boolean); // Filter out undefined rows

        const data = { students, subjects };
        localStorage.setItem("results", JSON.stringify(data));
      }

      // Generate table header
      function generateTableHeader() {
        const headerRow = resultTable
          .closest("table")
          .querySelector("thead tr");
        headerRow.innerHTML = ""; // Clear header
        headerRow.insertCell(0).innerText = "S. No";
        headerRow.insertCell(1).innerText = "Name";
        headerRow.insertCell(2).innerText = "Father's Name";

        subjects.forEach((subject) => {
          const cell = document.createElement("th");
          cell.innerText = subject;
          headerRow.appendChild(cell);
        });

        headerRow.insertCell().innerText = "T. obt Marks";
        headerRow.insertCell().innerText = "Percentage";
        headerRow.insertCell().innerText = "Grade";
      }

      // Load data on page load
      window.onload = () => {
        const storedData = JSON.parse(localStorage.getItem("results"));
        if (storedData) {
          subjects = storedData.subjects || ["English", "English B/R", "Urdu"];
          generateTableHeader();
          renderTable(storedData.students);
        } else {
          generateTableHeader();
        }
      };

      function deleteData() {
        const confirmDelete = confirm(
          "Are you sure you want to delete all data? This action cannot be undone."
        );

        if (confirmDelete) {
          // Clear the table body
          resultTable.innerHTML = "";

          // Reset subjects array to default subjects if you want to reset the subjects as well
          subjects = ["English", "English B/R", "Urdu"]; // Default subjects

          // Clear data from localStorage
          localStorage.removeItem("results");

          // Generate the table header again after clearing
          generateTableHeader();
        }
      }
      // Optional: Delete all data button

      function getMainHeading() {
        let mainHeading = prompt(
          "Enter the main heading for the PDF:",
          "Result Report"
        );

        // If input is empty or null, set default value
        if (!mainHeading || mainHeading.trim() === "") {
          mainHeading = "Result Report";
        }

        let isConfirmed = false;

        // Loop to allow the user to go back and edit the heading
        while (!isConfirmed) {
          isConfirmed = confirm(
            `You entered: "${mainHeading}". Do you want to proceed with this heading?`
          );

          if (!isConfirmed) {
            // Allow user to edit the heading
            mainHeading = prompt(
              "Edit the main heading for the PDF:",
              mainHeading
            );
            if (!mainHeading || mainHeading.trim() === "") {
              mainHeading = "Result Report"; // Reset to default if input is empty or null
            }
          }
        }

        return mainHeading;
      }

      // Check if "Don't show again" flag is set in localStorage
      if (localStorage.getItem("dontShowAgain") !== "1") {
        // Show the modal if the flag is not set
        document.getElementById("warningModal").style.display = "flex";
      }

      // Handle the "Don't show again" checkbox
      document
        .getElementById("dontShowAgainCheckbox")
        .addEventListener("change", function () {
          if (this.checked) {
            localStorage.setItem("dontShowAgain", "1");
          } else {
            localStorage.setItem("dontShowAgain", "0");
          }
        });

      // Close the modal when the "Close" button is clicked
      document
        .getElementById("closeModalButton")
        .addEventListener("click", function () {
          document.getElementById("warningModal").style.display = "none";
        });

      const downloadPdfButton = document.getElementById("download-pdf-btn");

      // Function to generate PDF
      downloadPdfButton.addEventListener("click", () => {
        const mainHeading = getMainHeading();
        // Calculate total students, pass students, and fail students
        const rows = Array.from(resultTable.rows);
        const totalStudents = rows.length;
        let passStudents = 0;
        let failStudents = 0;

        rows.forEach((row) => {
          const gradeCell = row.cells[subjects.length + 5]; // Adjusted index for "Grade"
          if (gradeCell && gradeCell.innerText !== "") {
            const grade = gradeCell.innerText;
            if (grade !== "F") {
              passStudents++;
            } else {
              failStudents++;
            }
          }
        });

        // Generate PDF in landscape orientation
        const { jsPDF } = window.jspdf;
        const pdf = new jsPDF({ orientation: "landscape" }); // Landscape mode

        // Title
        pdf.setFontSize(16);
        pdf.text(mainHeading, 140, 15, { align: "center" });

        // Statistics
        pdf.setFontSize(10);
        pdf.text(`Total Students: ${totalStudents}`, 14, 25);
        pdf.text(`Pass Students: ${passStudents}`, 55, 25);
        pdf.text(`Fail Students: ${failStudents}`, 95, 25);

        // Table Data Preparation
        const tableHeaders = [
          "Position",
          "Name",
          "Father's Name",
          ...subjects,
          "T. obt Marks",
          "Percentage",
          "Grade",
        ];

        // Make all table headers uppercase
        const uppercaseTableHeaders = tableHeaders.map((header) =>
          header.toUpperCase()
        );

        const tableBody = rows.map((row, rowIndex) => {
          const rowData = [
            rowIndex + 1, // Position
            row.cells[1]?.getElementsByTagName("input")[0]?.value || "", // Name
            row.cells[2]?.getElementsByTagName("input")[0]?.value || "", // Father's Name
          ];

          // Add marks for each subject
          subjects.forEach((_, index) => {
            rowData.push(
              row.cells[index + 3]?.getElementsByTagName("input")[0]?.value ||
                ""
            );
          });

          // Add Total Marks, Percentage, and Grade
          rowData.push(
            row.cells[subjects.length + 3]?.innerText || "", // Total Marks
            row.cells[subjects.length + 4]?.innerText || "", // Percentage
            row.cells[subjects.length + 5]?.innerText || "" // Grade
          );

          return rowData;
        });

        // Add Table to PDF using autoTable
        pdf.autoTable({
          startY: 35,
          head: [uppercaseTableHeaders], // Use uppercase headers
          body: tableBody,
          theme: "grid",
          styles: {
            fontSize: 10,
            halign: "center", // Center-aligns the text
          },
          headStyles: {
            // fillColor: [0, 102, 204],
            fillColor: [144, 238, 144],
            textColor: [80, 80, 80],
            halign: "center", // Center-aligns header text
          },
          alternateRowStyles: {
            fillColor: [240, 240, 240],
          },
          margin: { top: 10, left: 14, right: 14 },
        });

        // Add teacher's signature line
        const finalY = pdf.lastAutoTable.finalY || 35;
        pdf.text("Teacher's Signature: ____________________", 14, finalY + 15);
        var options = {
          weekday: "short",
          year: "numeric",
          month: "short",
          day: "numeric",
        };
        var today = new Date();
        pdf.text(
          `Dated: ${today.toLocaleDateString("en-US", options)}`,
          240,
          finalY + 15
        );

        // Save the PDF
        pdf.save("Result_Report.pdf");
      });
    </script>
  </body>
</html>
